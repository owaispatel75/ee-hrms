import{r as v,j as t}from"./ui-5WRyBZNT.js";import{P as fe}from"./page-template-CKIx2Cd4.js";import{u as ue,c as he,w as R,P as je,S as K,I as xe,n as g,L,r as u,t as n}from"./app-Dcb6Z4yW.js";import{S as H,a as W,b as q,c as G,d as _}from"./select-DeRz6PSF.js";import{P as ve}from"./pagination-BW8eSOCk.js";import{C as Ce}from"./CrudTable-bZrcaGsl.js";import{C as ye}from"./CrudFormModal-CMKQqXhM.js";import{C as Fe}from"./CrudDeleteModal-h-4oV4Ln.js";import{F as _e}from"./filter-CUtbTrvr.js";function Ue({config:N,title:J,url:Q,buttons:M=[],breadcrumbs:X}){var B;const{t:c}=ue(),{entity:o,table:O,filters:F=[],form:w,hooks:d}=N,{auth:b,globalSettings:r,...T}=he().props,A=(b==null?void 0:b.permissions)||[],y=T[o.name]||{data:[],links:[]},m=T.filters||{},[f,k]=v.useState(m.search||""),[C,E]=v.useState({}),[P,z]=v.useState(!1),[Y,j]=v.useState(!1),[Z,S]=v.useState(!1),[x,I]=v.useState(null),[h,$]=v.useState("create");v.useEffect(()=>{const e={};F.forEach(s=>{const l=s.name||s.key;e[l]=m[l]||""}),E(e)},[]);const U=()=>Object.entries(C).some(([e,s])=>s&&s!=="")||f!=="",ee=()=>Object.entries(C).filter(([e,s])=>s&&s!=="").length+(f?1:0),se=e=>{e.preventDefault(),re()},re=()=>{const e={page:1};f&&(e.search=f),Object.entries(C).forEach(([s,l])=>{l&&l!==""&&(e[s]=l)}),m.per_page&&(e.per_page=m.per_page),u.get(o.endpoint,e,{preserveState:!0,preserveScroll:!0})},ie=(e,s)=>{E(p=>({...p,[e]:s}));const l={page:1};f&&(l.search=f);const a={...C,[e]:s};Object.entries(a).forEach(([p,i])=>{i&&i!==""&&(l[p]=i)}),m.per_page&&(l.per_page=m.per_page),u.get(o.endpoint,l,{preserveState:!0,preserveScroll:!0})},ae=e=>{const s=m.sort_field===e&&m.sort_direction==="asc"?"desc":"asc",l={sort_field:e,sort_direction:s,page:1};f&&(l.search=f),Object.entries(C).forEach(([a,p])=>{p&&p!==""&&(l[a]=p)}),m.per_page&&(l.per_page=m.per_page),u.get(o.endpoint,l,{preserveState:!0,preserveScroll:!0})},te=(e,s)=>{switch(I(s),e){case"view":$("view"),j(!0);break;case"edit":$("edit"),j(!0);break;case"delete":S(!0);break}},oe=()=>{I(null),$("create"),j(!0)},ne=e=>{const s={...e};if(o.name==="roles"){if(s.permissions&&Array.isArray(s.permissions)){const p=s.permissions.map(i=>typeof i=="object"&&i!==null&&i.name?i.name:String(i));s.permissions=p}const a={label:s.label,description:s.description||"",permissions:s.permissions||[]};Object.keys(s).forEach(p=>{delete s[p]}),Object.assign(s,a)}else if(s.permissions&&Array.isArray(s.permissions)){const a={};s.permissions.forEach((p,i)=>{a[i]=String(p)}),s.permissions=a}if(o.name==="permissions"&&h==="edit"&&delete s.name,w.fields.some(a=>a.type==="file")){const a=w.fields.filter(i=>i.type==="file").map(i=>i.name),p=new FormData;Object.keys(s).forEach(i=>{if(a.includes(i)&&h==="edit"){s[i]&&typeof s[i]=="object"&&p.append(i,s[i]);return}p.append(i,s[i])}),h==="create"?(r!=null&&r.is_demo||n.loading(c("Creating...")),u.post(o.endpoint,p,{onSuccess:i=>{j(!1),r!=null&&r.is_demo||n.dismiss(),i.props.flash.success?n.success(c(i.props.flash.success)):i.props.flash.error&&n.error(c(i.props.flash.error)),d!=null&&d.afterCreate&&d.afterCreate(e,i.props[o.name])},onError:i=>{r!=null&&r.is_demo||n.dismiss(),typeof i=="string"?n.error(c(i)):n.error(c(`Failed to create ${o.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(i).join(", ")}))}})):h==="edit"&&(r!=null&&r.is_demo||n.loading(c("Updating...")),u.post(`${o.endpoint}/${x.id}?_method=PUT`,p,{onSuccess:i=>{j(!1),r!=null&&r.is_demo||n.dismiss(),i.props.flash.success?n.success(c(i.props.flash.success)):i.props.flash.error&&n.error(c(i.props.flash.error)),d!=null&&d.afterUpdate&&d.afterUpdate(e,i.props[o.name])},onError:i=>{r!=null&&r.is_demo||n.dismiss(),typeof i=="string"?n.error(c(i)):n.error(c(`Failed to update ${o.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(i).join(", ")}))}}));return}h==="create"?(r!=null&&r.is_demo||n.loading(c("Creating...")),u.post(o.endpoint,s,{onSuccess:a=>{j(!1),r!=null&&r.is_demo||n.dismiss(),a.props.flash.success?n.success(c(a.props.flash.success)):a.props.flash.error&&n.error(c(a.props.flash.error)),d!=null&&d.afterCreate&&d.afterCreate(e,a.props[o.name])},onError:a=>{r!=null&&r.is_demo||n.dismiss(),typeof a=="string"?n.error(c(a)):n.error(c(`Failed to create ${o.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(a).join(", ")}))}})):h==="edit"&&(r!=null&&r.is_demo||n.loading(c("Updating...")),u.put(`${o.endpoint}/${x.id}`,s,{onSuccess:a=>{j(!1),r!=null&&r.is_demo||n.dismiss(),a.props.flash.success?n.success(c(a.props.flash.success)):a.props.flash.error&&n.error(c(a.props.flash.error)),d!=null&&d.afterUpdate&&d.afterUpdate(e,a.props[o.name])},onError:a=>{r!=null&&r.is_demo||n.dismiss(),typeof a=="string"?n.error(c(a)):n.error(c(`Failed to update ${o.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(a).join(", ")}))}}))},ce=()=>{r!=null&&r.is_demo||n.loading(c("Deleting...")),u.delete(`${o.endpoint}/${x.id}`,{onSuccess:e=>{S(!1),r!=null&&r.is_demo||n.dismiss(),e.props.flash.success?n.success(c(e.props.flash.success)):e.props.flash.error&&n.error(c(e.props.flash.error)),d!=null&&d.afterDelete&&d.afterDelete(x.id)},onError:e=>{r!=null&&r.is_demo||n.dismiss(),typeof e=="string"?n.error(c(e)):n.error(c(`Failed to delete ${o.name.slice(0,-1)}: {{errors}}`,{errors:Object.values(e).join(", ")}))}})},le=()=>{const e={};F.forEach(s=>{e[s.key]=s.type==="select"?"all":""}),E(e),k(""),z(!1),u.get(o.endpoint,{page:1,per_page:m.per_page},{preserveState:!0,preserveScroll:!0})},de=M.every(e=>e.showAddButton!==!1),D=[];M.forEach(e=>{(!e.permission||R(A,e.permission))&&D.push({label:e.label,icon:e.icon,variant:e.variant,onClick:e.onClick})}),de&&R(A,o.permissions.create)&&D.push({label:`Add New ${o.name.slice(0,-1).charAt(0).toUpperCase()+o.name.slice(0,-1).slice(1)}`,icon:t.jsx(je,{className:"h-4 w-4"}),variant:"default",onClick:()=>oe()});const V=J||o.name.charAt(0).toUpperCase()+o.name.slice(1),pe=[{title:c("Dashboard"),href:route("dashboard")},{title:V}],me=X||pe;return t.jsxs(fe,{title:V,url:Q,actions:D,breadcrumbs:me,noPadding:!0,children:[t.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4",children:t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("form",{onSubmit:se,className:"flex gap-2",children:[t.jsxs("div",{className:"relative w-64",children:[t.jsx(K,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx(xe,{placeholder:`Search ${o.name}...`,value:f,onChange:e=>k(e.target.value),className:"w-full pl-9"})]}),t.jsxs(g,{type:"submit",size:"sm",children:[t.jsx(K,{className:"h-4 w-4 mr-1.5"}),c("Search")]})]}),F.length>0&&t.jsx("div",{className:"ml-2",children:t.jsxs(g,{variant:U()?"default":"outline",size:"sm",className:"h-8 px-2 py-1",onClick:()=>z(!P),children:[t.jsx(_e,{className:"h-3.5 w-3.5 mr-1.5"}),P?"Hide Filters":"Filters",U()&&t.jsx("span",{className:"ml-1 bg-primary-foreground text-primary rounded-full w-5 h-5 flex items-center justify-center text-xs",children:ee()})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(L,{className:"text-xs text-muted-foreground",children:[c("Per Page"),":"]}),t.jsxs(H,{value:((B=m.per_page)==null?void 0:B.toString())||"10",onValueChange:e=>{const s={page:1,per_page:parseInt(e)};f&&(s.search=f),Object.entries(C).forEach(([l,a])=>{a&&a!==""&&(s[l]=a)}),u.get(o.endpoint,s,{preserveState:!0,preserveScroll:!0})},children:[t.jsx(W,{className:"w-16 h-8",children:t.jsx(q,{})}),t.jsxs(G,{children:[t.jsx(_,{value:"10",children:"10"}),t.jsx(_,{value:"25",children:"25"}),t.jsx(_,{value:"50",children:"50"}),t.jsx(_,{value:"100",children:"100"})]})]})]})]}),P&&F.length>0&&t.jsx("div",{className:"w-full mt-3 p-4 bg-gray-50 dark:bg-gray-800 border dark:border-gray-700 rounded-md",children:t.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[F.map(e=>{var l;const s=e.name||e.key;return t.jsxs("div",{className:"space-y-2",children:[t.jsx(L,{children:e.label}),e.type==="select"&&t.jsxs(H,{value:C[s]||"",onValueChange:a=>ie(s,a),children:[t.jsx(W,{className:"w-40",children:t.jsx(q,{placeholder:`All ${e.label}`})}),t.jsx(G,{children:(l=e.options)==null?void 0:l.map(a=>t.jsx(_,{value:a.value,children:a.label},a.value))})]})]},s)}),t.jsx(g,{variant:"outline",size:"sm",className:"h-9",onClick:le,disabled:!U(),children:c("Reset Filters")})]})})]})}),t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[t.jsx(Ce,{columns:O.columns,actions:O.actions,data:y.data,from:y.from||1,onAction:te,sortField:m.sort_field,sortDirection:m.sort_direction,onSort:ae,statusColors:O.statusColors,permissions:A,entityPermissions:o.permissions}),t.jsx(ve,{from:y.from||0,to:y.to||0,total:y.total,links:y.links,entityName:o.name,onPageChange:e=>u.get(e)})]}),t.jsx(ye,{isOpen:Y,onClose:()=>j(!1),onSubmit:ne,formConfig:{...w,modalSize:N.modalSize||w.modalSize},initialData:x,title:h==="create"?`Add New ${o.name.slice(0,-1).charAt(0).toUpperCase()+o.name.slice(0,-1).slice(1)}`:h==="edit"?`Edit ${o.name.slice(0,-1).charAt(0).toUpperCase()+o.name.slice(0,-1).slice(1)}`:`View ${o.name.slice(0,-1).charAt(0).toUpperCase()+o.name.slice(0,-1).slice(1)}`,mode:h,description:N.description}),t.jsx(Fe,{isOpen:Z,onClose:()=>S(!1),onConfirm:ce,itemName:(x==null?void 0:x.name)||"",entityName:o.name.slice(0,-1)})]})}export{Ue as P};
