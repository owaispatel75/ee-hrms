import{r as f,j as r}from"./ui-5WRyBZNT.js";import{P as I}from"./PageCrudWrapper-DfXR7dYQ.js";import{t as d}from"./i18n-C_pO9QB7.js";import{a as M,b as R,C as L}from"./checkbox-B5iZmSiS.js";import{J as O,e as C,u as S,L as k,c as $}from"./app-Dcb6Z4yW.js";import{c as q}from"./CrudTable-bZrcaGsl.js";import"./page-template-CKIx2Cd4.js";import"./textarea-LYs2mVcU.js";import"./select-DeRz6PSF.js";import"./index-BdQq_4o_.js";import"./index-CCaALC5E.js";import"./language-WoaYFWNr.js";import"./trophy-CwLH3bof.js";import"./loader-circle-BHYyy5xm.js";import"./copy-CEvMX_m9.js";import"./CookieConsentBanner-DQyHDBeh.js";import"./switch-t9Hay6Hq.js";import"./chevron-right-D-6n0McF.js";import"./credit-card-DqjaQidM.js";import"./dollar-sign-Cwr3Gu39.js";import"./users-CMrPg0xJ.js";import"./clock-bjnTPlpB.js";import"./calendar-DCWku5XV.js";import"./user-mASyYuwG.js";import"./use-favicon-DuYrl8Bg.js";import"./use-brand-theme-Bndhjp9t.js";import"./pagination-BW8eSOCk.js";import"./ellipsis-CcCiYkNb.js";import"./chevron-left-CAhfRZ8t.js";import"./CrudFormModal-CMKQqXhM.js";import"./radio-group-CWZh11qV.js";import"./circle-CTH8Grzw.js";import"./scroll-area-BNTU7Fcp.js";import"./CrudDeleteModal-h-4oV4Ln.js";import"./filter-CUtbTrvr.js";/* empty css            *//* empty css                  */import"./utils-BkYo4WJR.js";import"./table-CVC2OwXt.js";import"./unlink-M-7GhMDo.js";import"./wrench-EpLqRNAD.js";import"./arrow-left-2RHqSM1t.js";import"./ticket-49lGndAA.js";import"./lock-open-C1AE0wa5.js";import"./award-Ds8Pn3VU.js";import"./ban-CoJEhB2G.js";import"./wallet-V5ITs3Yp.js";import"./bell-DGfoV3HU.js";import"./building-2-NAKjIPfs.js";import"./building-Yd460mDP.js";import"./trending-down-uJsbmf-r.js";import"./camera-8w012zob.js";import"./chart-column-B4Juta60.js";import"./chart-no-axes-column-increasing-CxynlTOn.js";import"./circle-alert-DyiJ_7fc.js";import"./circle-check-big-DvjFjVFs.js";import"./circle-check-SPi-Xvck.js";import"./clipboard-list-BeCtsJjD.js";import"./zap-C99Wcc2V.js";import"./download-D7x9V5HF.js";import"./external-link-jFGKNT7b.js";import"./eye-off-ZW0JdLst.js";import"./eye-BauIsDws.js";import"./rotate-ccw-C8Q-gmhj.js";import"./hard-drive-B2P2rmjY.js";import"./info-DMPjqPji.js";import"./key-CGMSITmc.js";import"./lightbulb-CAdzOdqD.js";import"./link-2-DCTQflBu.js";import"./list-DOApis6K.js";import"./lock-DTdsSPVo.js";import"./mail-DLXHGnVS.js";import"./map-pin-zN3uCaOh.js";import"./phone-C8cPu9FG.js";import"./printer-ChUpiFfe.js";import"./refresh-cw-BLGufQC4.js";import"./send-COw_7dkc.js";import"./server-B9axTPGI.js";import"./square-pen-B2niO3pF.js";import"./star-C6nMG0b0.js";import"./trash-2-CeLXIVfe.js";import"./trash-BE31V_4e.js";import"./trending-up-ClbmsTa0.js";import"./triangle-alert-Bgud0J1k.js";import"./user-plus-Dd4He1MR.js";const j={entity:{name:"roles",endpoint:route("roles.index"),permissions:{view:"view-roles",create:"create-roles",edit:"edit-roles",delete:"delete-roles"}},modalSize:"5xl",description:d("Manage user roles and their permissions"),table:{columns:[{key:"label",label:d("Name"),sortable:!0},{key:"name",label:d("Slug"),sortable:!0},{key:"description",label:d("Description")}],actions:[{label:d("View"),icon:"Eye",action:"view",className:"text-blue-500",requiredPermission:"view-roles"},{label:d("Edit"),icon:"Edit",action:"edit",className:"text-amber-500",requiredPermission:"edit-roles"},{label:d("Delete"),icon:"Trash2",action:"delete",className:"text-red-500",requiredPermission:"delete-roles",condition:s=>!s.is_system_role}]},filters:[],form:{fields:[{name:"label",label:d("Role Name"),type:"text",required:!0},{name:"description",label:d("Description"),type:"textarea"}]}},v=f.forwardRef(({className:s,indeterminate:o,...p},c)=>{const n=f.useRef(null);return f.useImperativeHandle(c,()=>n.current),f.useEffect(()=>{n.current&&(n.current.dataset.state=o?"indeterminate":p.checked?"checked":"unchecked")},[o,p.checked]),r.jsx(M,{ref:n,className:C("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=indeterminate]:bg-primary data-[state=indeterminate]:text-primary-foreground",s),...p,children:r.jsx(R,{className:C("flex items-center justify-center text-current"),children:o?r.jsx(q,{className:"h-3 w-3"}):r.jsx(O,{className:"h-4 w-4"})})})});v.displayName="IndeterminateCheckbox";function T({permissions:s,selectedPermissions:o,onChange:p}){const{t:c}=S(),[n,u]=f.useState([]),h=s,a=()=>{const t=[];return Object.values(h).forEach(i=>{i.forEach(e=>{t.push(e.id.toString())})}),t},x=t=>{var i;return((i=h[t])==null?void 0:i.map(e=>e.id.toString()))||[]};f.useEffect(()=>{if(!o||Object.keys(h).length===0){u([]);return}try{const t={};Object.values(h).forEach(e=>{e.forEach(l=>{t[l.name]=l.id.toString()})});let i=[];Array.isArray(o)?i=o.map(e=>{if(typeof e=="object"&&e!==null){if("id"in e)return e.id.toString();if("name"in e)return t[e.name]||e.name}return t[String(e)]||String(e)}).filter(Boolean):typeof o=="object"&&o!==null&&"permissions"in o&&Array.isArray(o.permissions)&&(i=o.permissions.map(e=>{if(typeof e=="object"&&e!==null){if("id"in e)return e.id.toString();if("name"in e)return t[e.name]||e.name}return t[String(e)]||String(e)}).filter(Boolean)),u(i)}catch(t){console.error("Error processing permissions:",t),u([])}},[o]);const m=(t,i)=>{const e=i?[...n,t]:n.filter(l=>l!==t);u(e),N(e)},g=(t,i)=>{const e=x(t);let l;if(i){const y=e.filter(A=>!n.includes(A));l=[...n,...y]}else l=n.filter(y=>!e.includes(y));u(l),N(l)},b=t=>{const i=t?a():[];u(i),N(i)},N=t=>{const i={};Object.values(h).forEach(l=>{l.forEach(y=>{i[y.id.toString()]=y.name})});const e=t.map(l=>i[l]||l).filter(l=>!!l);p(e)},w=n.length===a().length&&a().length>0,E=t=>{const i=x(t);return i.every(e=>n.includes(e))&&i.length>0},P=t=>{const i=x(t),e=i.filter(l=>n.includes(l)).length;return e>0&&e<i.length};return r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"border rounded shadow-sm p-3 bg-gray-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(v,{id:"select-all-permissions-checkbox",checked:w,onCheckedChange:t=>b(t===!0)}),r.jsx(k,{htmlFor:"select-all-permissions-checkbox",className:"font-medium",children:c("Select All Permissions")})]}),r.jsxs("div",{className:"text-xs text-gray-500",children:[n.length," ",c("of")," ",a().length," ",c("selected")]})]})}),r.jsx("div",{className:"space-y-6",children:Object.entries(h).map(([t,i])=>r.jsxs("div",{className:"border rounded shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border-b",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(v,{id:`module-checkbox-${t.replace(/\s+/g,"-").toLowerCase()}`,checked:E(t),indeterminate:P(t),onCheckedChange:e=>g(t,e===!0)}),r.jsx(k,{htmlFor:`module-checkbox-${t.replace(/\s+/g,"-").toLowerCase()}`,className:"font-medium",children:t})]}),r.jsxs("div",{className:"text-xs text-gray-500",children:[i.filter(e=>n.includes(e.id.toString())).length," of ",i.length," ",c("selected")]})]}),r.jsx("div",{className:"p-3",children:r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:i.map(e=>r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(L,{id:`permission-checkbox-${e.id.toString().replace(/\s+/g,"-").toLowerCase()}`,checked:n.includes(e.id.toString())||n.includes(e.name),onCheckedChange:l=>m(e.id.toString(),l===!0)}),r.jsx(k,{htmlFor:`permission-checkbox-${e.id.toString().replace(/\s+/g,"-").toLowerCase()}`,className:"text-sm truncate",children:e.label})]},e.id))})})]},t))})]})}function B({permissions:s=[],maxDisplay:o=3}){const{t:p}=S();return!s||!Array.isArray(s)||s.length===0?r.jsx("span",{className:"text-sm text-gray-500",children:"-"}):r.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,o).map((c,n)=>r.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:c.label||c.name},n)),s.length>o&&r.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:["+",s.length-o," ",p("more")]})]})}function xt(){const{t:s}=S(),{permissions:o,flash:p,auth:c}=$().props,[n,u]=f.useState(j);f.useEffect(()=>{o&&u({...j,table:{...j.table,columns:[...j.table.columns,{key:"permissions",label:s("Permissions"),render:(a,x)=>r.jsx(B,{permissions:a||[]})}]},form:{...j.form,fields:[...j.form.fields.map(a=>a.name==="label"?{...a,render:(x,m,g)=>{const b=(m==null?void 0:m.id)&&!(m!=null&&m.is_editable);return r.jsx("input",{type:"text",className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${b?"disabled:cursor-not-allowed disabled:opacity-50":""}`,value:m.label||"",onChange:N=>g("label",N.target.value),disabled:b,placeholder:"Enter role name",required:!0})}}:a).filter(a=>a.name!=="permissions"),{name:"permissions",label:s("Role Permissions"),type:"custom",colSpan:12,render:(a,x,m)=>{var g;return r.jsxs("div",{className:"mt-4",id:"permissions",children:[r.jsx("h3",{className:"text-lg font-medium mb-2",children:s("Manage Permissions")}),r.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[s("Select permissions for this role. You can select all permissions at once or manage them by module."),((g=c.user)==null?void 0:g.type)!=="superadmin"&&r.jsx("span",{className:"block mt-1 text-amber-600",children:s("Note: Only permissions for modules available to your role are shown.")})]}),r.jsx(T,{permissions:o,selectedPermissions:x.permissions||[],onChange:b=>{m("permissions",b)}})]})}}]}})},[o,s]);const h=[{title:s("Dashboard"),href:route("dashboard")},{title:s("Staff"),href:route("roles.index")},{title:s("Roles")}];return r.jsx(I,{config:n,url:"/roles",breadcrumbs:h})}export{xt as default};
