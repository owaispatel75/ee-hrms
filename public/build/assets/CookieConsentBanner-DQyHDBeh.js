import{r as g,j as e}from"./ui-5WRyBZNT.js";import{u as z,c as L,a as E,C,n as c,X as N,T as O,t as v}from"./app-Dcb6Z4yW.js";import{S as U}from"./switch-t9Hay6Hq.js";function M(){const{t}=z(),{props:y}=L(),[S,u]=g.useState(!1),[T,f]=g.useState(!1),[a,h]=g.useState(!1),{themeColor:w,customColor:D}=E(),l=w==="custom"?D:O[w],o=y.globalSettings||{},i={cookieTitle:o.cookieTitle||"Cookie Consent",cookieDescription:o.cookieDescription||"We use cookies to enhance your browsing experience and provide personalized content.",strictlyCookieTitle:o.strictlyCookieTitle||"Strictly Necessary Cookies",strictlyCookieDescription:o.strictlyCookieDescription||"These cookies are essential for the website to function properly.",contactUsDescription:o.contactUsDescription||"If you have any questions about our cookie policy, please contact us.",contactUsUrl:o.contactUsUrl||"#"};g.useEffect(()=>{var p,m;const s=o.enableLogging==="1"||o.enableLogging===1||o.enableLogging===!0,d=o.is_demo==="1"||o.is_demo===1||o.is_demo===!0,r=window.location.pathname==="/dashboard"||window.location.pathname.includes("/dashboard"),n=(m=(p=y.auth)==null?void 0:p.user)==null?void 0:m.type;if(s){if(d&&(!r||n!=="company"))return;localStorage.getItem("cookie-consent")||u(!0)}},[]);const A=async()=>{try{const s=new AbortController,d=setTimeout(()=>s.abort(),5e3),r=await fetch("https://ipapi.co/json/",{signal:s.signal,headers:{Accept:"application/json"}});if(clearTimeout(d),!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();return{ip:n.ip||"unknown",country:n.country_name||"unknown",city:n.city||"unknown",region:n.region||"unknown",...n}}catch(s){return console.warn("Failed to get location data:",s.message),{ip:"unknown",country:"unknown",city:"unknown",region:"unknown",error:s.message||"Location fetch failed"}}},k=async(s,d)=>{var r;try{const n=await A(),p={...d,timestamp:new Date().toISOString(),consentType:s,userAgent:navigator.userAgent||"unknown",language:navigator.language||"unknown",url:window.location.href,...n};localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()}));const m=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");if(!m){console.warn("CSRF token not found");return}const x=await fetch(route("cookie.consent.store"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m,Accept:"application/json"},body:JSON.stringify(p)});if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);if(!(await x.json()).success)throw new Error("Server returned error")}catch(n){throw console.error("Failed to save cookie consent:",n),localStorage.setItem("cookie-consent",JSON.stringify({accepted:!0,timestamp:Date.now()})),n}},j=async()=>{if(!a){h(!0);try{await k("accept_all",{necessary:!0,analytics:!0,marketing:!0}),u(!1)}catch{v.error(t("Failed to save cookie preferences"))}finally{h(!1)}}},b=async()=>{if(!a){h(!0);try{await k("necessary_only",{necessary:!0,analytics:!1,marketing:!1}),u(!1)}catch{v.error(t("Failed to save cookie preferences"))}finally{h(!1)}}};return S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 max-w-md w-full mx-4",children:e.jsxs(C,{className:"p-4 shadow-lg border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:i.cookieTitle}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>u(!1),className:"h-6 w-6 p-0",children:e.jsx(N,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:i.cookieDescription}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:j,size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:l},disabled:a,children:t(a?"Saving...":"Accept All")}),e.jsx(c,{onClick:b,variant:"outline",size:"sm",className:"flex-1",style:{borderColor:l,color:l},disabled:a,children:t(a?"Saving...":"Necessary Only")})]}),e.jsx(c,{onClick:()=>f(!0),variant:"ghost",size:"sm",className:"text-sm underline",children:t("Let me choose")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[i.contactUsDescription," ",e.jsx("a",{href:i.contactUsUrl,className:"underline",children:t("Contact us")})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:e.jsx(C,{className:"w-full max-w-md max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:i.cookieTitle}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>f(!1),className:"h-6 w-6 p-0",children:e.jsx(N,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:i.strictlyCookieTitle}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.strictlyCookieDescription})]}),e.jsx(U,{checked:!0,disabled:!0})]})}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx(c,{onClick:async()=>{await b(),f(!1)},variant:"outline",size:"sm",className:"flex-1",style:{borderColor:l,color:l},disabled:a,children:t(a?"Saving...":"Save Preferences")}),e.jsx(c,{onClick:async()=>{await j(),f(!1)},size:"sm",className:"flex-1 text-white hover:opacity-90",style:{backgroundColor:l},disabled:a,children:t(a?"Saving...":"Accept All")})]})]})})})]}):null}export{M as C};
