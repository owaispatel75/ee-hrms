import{r as F,j as a}from"./ui-5WRyBZNT.js";import{B as ae,X as ne,c as te,u as se,D as re,h as ce,i as oe,j as le,o as me,L as I,p as ie,n as Q,I as R,M as ue}from"./app-Dcb6Z4yW.js";import{T as pe}from"./textarea-LYs2mVcU.js";import{S as xe,a as de,b as he,c as ye,d as X}from"./select-DeRz6PSF.js";import{R as ge,a as be}from"./radio-group-CWZh11qV.js";import{C as je}from"./checkbox-B5iZmSiS.js";import{S as ve}from"./switch-t9Hay6Hq.js";import{S as we}from"./scroll-area-BNTU7Fcp.js";function Se({options:p,selected:j,onChange:N,placeholder:x="Select options",className:h}){const[$,i]=F.useState(!1),[A,V]=F.useState(""),y=F.useRef(null);F.useEffect(()=>{function r(o){y.current&&!y.current.contains(o.target)&&i(!1)}return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]);const t=r=>{j.includes(r)||N([...j,r]),V(""),setTimeout(()=>{var v;const o=(v=y.current)==null?void 0:v.querySelector("input");o&&o.focus()},10)},u=r=>{N(j.filter(o=>o!==r))},s=p.filter(r=>(A||!j.includes(r.value))&&r.label.toLowerCase().includes(A.toLowerCase()));return a.jsxs("div",{ref:y,className:`relative ${h}`,children:[a.jsxs("div",{className:"flex flex-wrap gap-1 p-2 border rounded-md min-h-[38px] cursor-text",onClick:()=>i(!0),children:[j.map(r=>{const o=p.find(v=>v.value===r);return a.jsxs(ae,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[(o==null?void 0:o.label)||r,a.jsx("button",{type:"button",className:"ml-1 rounded-sm",onClick:v=>{v.stopPropagation(),u(r)},children:a.jsx(ne,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},r)}),a.jsx("input",{type:"text",value:A,onChange:r=>V(r.target.value),onFocus:()=>i(!0),placeholder:j.length===0?x:"",className:"flex-1 outline-none bg-transparent min-w-[50px]"})]}),$&&s.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg max-h-[200px] overflow-y-auto",children:s.map(r=>a.jsx("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>{t(r.value),i(!0)},children:r.label},r.value))})]})}function Ne({field:p,formData:j,handleChange:N}){const x=Array.isArray(j[p.name])?j[p.name]:j[p.name]?[j[p.name].toString()]:[];return a.jsx(Se,{options:p.options||[],selected:x,onChange:h=>N(p.name,h),placeholder:p.placeholder||`Select ${p.label}`})}function Fe({fields:p,values:j,onChange:N,disabled:x=!1}){const{base_url:h}=te().props,[$,i]=F.useState(()=>{const u={};return p.forEach((s,r)=>{r===0?u[s.name]=s.options||[]:u[s.name]=[]}),u}),[A,V]=F.useState({}),y=async(u,s)=>{var r;if(!u.apiEndpoint)return[];V(o=>({...o,[u.name]:!0}));try{let o=u.apiEndpoint;if(s){const d=encodeURIComponent(String(s)),b=(r=p[p.indexOf(u)-1])==null?void 0:r.name;b&&(o=o.replace(`{${b}}`,d))}const v=await fetch(`${h}${o}`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const w=await v.json();return Array.isArray(w)?w.map(d=>({value:String(d.id||d.value||""),label:String(d.name||d.label||"Unknown")})):[]}catch{return[]}finally{V(o=>({...o,[u.name]:!1}))}};F.useEffect(()=>{(async()=>{const s={};for(let r=0;r<p.length;r++){const o=p[r];if(r===0)o.apiEndpoint?s[o.name]=await y(o):s[o.name]=o.options||[];else{const v=p[r-1],w=j[v.name];w?o.apiEndpoint?s[o.name]=await y(o,w):o.dependencies?s[o.name]=o.dependencies[w]||[]:s[o.name]=[]:s[o.name]=[]}}i(s)})()},[p]);const t=async(u,s,r)=>{p.slice(r+1).forEach(b=>{N(b.name,"")});const o=p.find(b=>b.name===u),w=($[u]||(o==null?void 0:o.options)||[]).find(b=>String(b.value)===String(s)),g=w?{id:s,name:w.label}:null,d=p[r+1];if(d&&s){if(d.apiEndpoint){const b=await y(d,s);i(k=>({...k,[d.name]:b})),d.selectFirstOption&&b.length>0&&setTimeout(()=>{N(d.name,b[0].value)},100),N(u,s,{selectedInfo:g,loadedOptions:b});return}else if(d.dependencies){const b=d.dependencies[s]||[];i(k=>({...k,[d.name]:b})),N(u,s,{selectedInfo:g,loadedOptions:b});return}}N(u,s,{selectedInfo:g,loadedOptions:[]})};return a.jsx("div",{className:"space-y-4",children:p.map((u,s)=>{const r=s===0,o=r?null:p[s-1],v=x||!r&&!j[o.name],w=$[u.name]||[],g=A[u.name];return a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:u.label}),a.jsxs("select",{value:j[u.name]||"",onChange:d=>t(u.name,d.target.value,s),disabled:v||g||u.disabled,className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[a.jsx("option",{value:"",className:"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none text-muted-foreground",children:g?"Loading...":`Select ${u.label.toLowerCase()}`}),w.map(d=>a.jsx("option",{value:d.value,className:"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",children:d.label},d.value))]})]},u.name)})})}function ke({isOpen:p,onClose:j,onSubmit:N,formConfig:x,initialData:h={},title:$,mode:i,description:A,errors:V={}}){const{t:y}=se(),[t,u]=F.useState({}),[s,r]=F.useState({}),[o,v]=F.useState({}),w=()=>{if(!x.priceSummary)return 0;const e=t[x.priceSummary.quantityFieldName||"quantity"]||x.priceSummary.quantity||1;return x.priceSummary.unitPrice*e};F.useEffect(()=>{if(p){const e={...h};x.fields.forEach(m=>{m.type==="multi-select"&&e[m.name]&&!Array.isArray(e[m.name])&&(e[m.name]=Array.isArray(e[m.name])?e[m.name]:e[m.name]?[e[m.name].toString()]:[]),i==="create"&&(e[m.name]===void 0||e[m.name]===null)&&m.defaultValue!==void 0&&(e[m.name]=m.defaultValue)}),u(e||{}),r({}),x.fields.forEach(m=>{m.relation&&m.relation.endpoint&&fetch(m.relation.endpoint).then(c=>c.json()).then(c=>{v(S=>({...S,[m.name]:Array.isArray(c)?c:c.data||[]}))}).catch(c=>{})})}},[p,h,x.fields,i]),F.useEffect(()=>{if(V&&Object.keys(V).length>0){const e={};Object.entries(V).forEach(([m,c])=>{e[m]=Array.isArray(c)?c[0]:c}),r(e)}},[V]);const g=(e,m)=>{u(c=>({...c,[e]:m})),s[e]&&r(c=>{const S={...c};return delete S[e],S})},d=e=>{e.preventDefault();const m={...t};x.fields.forEach(l=>{l.type==="multi-select"&&m[l.name]&&(Array.isArray(m[l.name])||(m[l.name]=[m[l.name].toString()]))}),u(m);const c={};if(x.fields.forEach(l=>{if(l.type==="file"&&i==="edit")return;const z=l.conditional?l.conditional(i,t):!0;if(l.required&&z&&!t[l.name]&&(c[l.name]=`${l.label} is required`),l.type==="file"&&t[l.name]&&l.fileValidation){const C=t[l.name];if(l.fileValidation.maxSize&&C.size>l.fileValidation.maxSize){const O=l.fileValidation.maxSize/1048576;c[l.name]=`File size must be less than ${O}MB`}if(l.fileValidation.mimeTypes&&l.fileValidation.mimeTypes.length>0&&(l.fileValidation.mimeTypes.includes(C.type)||(c[l.name]=`File type must be one of: ${l.fileValidation.mimeTypes.join(", ")}`)),l.fileValidation.extensions&&l.fileValidation.extensions.length>0){const O=C.name,E=O.substring(O.lastIndexOf(".")).toLowerCase();l.fileValidation.extensions.includes(E)||(c[l.name]=`File extension must be one of: ${l.fileValidation.extensions.join(", ")}`)}}}),Object.keys(c).length>0){r(c);return}const S={...t};x.fields.forEach(l=>{l.type==="multi-select"&&S[l.name]&&(Array.isArray(S[l.name])||(S[l.name]=[S[l.name].toString()]))}),N(S)},b=e=>{var m,c,S,l,z,C;if(e.conditional&&!e.conditional(i,t))return null;if(e.render)return e.render(e,t,g);if(i==="view"){if(e.type==="multi-select"){const E=(Array.isArray(t[e.name])?t[e.name]:[]).map(T=>{var L;const q=(L=e.options)==null?void 0:L.find(P=>P.value===T);return q?q.label:T}).join(", ");return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:E||"-"})}return a.jsx("div",{className:"p-2 border rounded-md bg-gray-50",children:e.type==="select"&&e.options?((m=e.options.find(O=>O.value===String(t[e.name])))==null?void 0:m.label)||t[e.name]||"-":e.type==="checkbox"?t[e.name]===!0||t[e.name]===1||t[e.name]==="1"?y("Yes"):y("No"):t[e.name]||"-"})}switch(e.type){case"text":case"email":case"password":case"time":case"color":return a.jsx(R,{id:e.name,name:e.name,type:e.type,placeholder:e.placeholder,value:t[e.name]||"",onChange:n=>g(e.name,n.target.value),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"date":const O=t[e.name]?t[e.name]instanceof Date?t[e.name].toISOString().split("T")[0]:typeof t[e.name]=="string"&&t[e.name].includes("T")?t[e.name].split("T")[0]:t[e.name]:"";return a.jsx(R,{id:e.name,name:e.name,type:"date",placeholder:e.placeholder,value:O,onChange:n=>g(e.name,n.target.value),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"number":return a.jsx(R,{id:e.name,name:e.name,type:"number",placeholder:e.placeholder,value:t[e.name]||"",onChange:n=>g(e.name,n.target.value?parseFloat(n.target.value):""),required:e.required,className:s[e.name]?"border-red-500":"",disabled:e.disabled||i==="view",readOnly:e.readOnly});case"textarea":return a.jsx(pe,{id:e.name,name:e.name,placeholder:e.placeholder,value:t[e.name]||"",onChange:n=>g(e.name,n.target.value),required:e.required,className:s[e.name]?"border-red-500":"",disabled:i==="view"});case"select":const E=e.relation?o[e.name]||[]:e.options||[],T=String(t[e.name]||""),q=e.relation?E.find(n=>String(n[e.relation.valueField])===T):E.find(n=>String(n.value)===T),L=q?e.relation?q[e.relation.labelField]:q.label:"";return a.jsxs(xe,{value:T,onValueChange:n=>g(e.name,n),disabled:i==="view",children:[a.jsx(de,{className:s[e.name]?"border-red-500":"",children:a.jsx(he,{placeholder:e.placeholder||`Select ${e.label}`,children:L||e.placeholder||`Select ${e.label}`})}),a.jsx(ye,{className:"z-[60000]",searchable:e.searchable,children:e.relation?E.map(n=>a.jsx(X,{value:String(n[e.relation.valueField]),children:n[e.relation.labelField]},n[e.relation.valueField])):E.map(n=>a.jsx(X,{value:String(n.value),children:n.label},n.value))})]});case"radio":return a.jsx(ge,{value:t[e.name]||"",onValueChange:n=>g(e.name,n),disabled:i==="view",className:"flex gap-4",children:(c=e.options)==null?void 0:c.map(n=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(be,{value:n.value,id:`${e.name}-${n.value}`}),a.jsx(I,{htmlFor:`${e.name}-${n.value}`,children:n.label})]},n.value))});case"checkbox":return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(je,{id:e.name,checked:!!t[e.name],onCheckedChange:n=>g(e.name,n),disabled:i==="view"}),a.jsx(I,{htmlFor:e.name,children:e.placeholder||e.label})]});case"switch":return a.jsx(ve,{id:e.name,checked:!!t[e.name],onCheckedChange:n=>g(e.name,n),disabled:i==="view"});case"multi-select":return a.jsx(Ne,{field:e,formData:t,handleChange:g});case"media-picker":const P=t[e.name]||(i==="edit"&&h[e.name]?h[e.name].startsWith("http")?h[e.name]:`/storage/${h[e.name]}`:"");return a.jsx(ue,{value:P,onChange:n=>g(e.name,n),placeholder:e.placeholder||`Select ${e.label}`,showPreview:!0});case"file":const U=((S=e.fileValidation)==null?void 0:S.accept)||"",Z=U.includes("image")||(((z=(l=e.fileValidation)==null?void 0:l.mimeTypes)==null?void 0:z.some(n=>n.startsWith("image/")))??!1);return a.jsxs(a.Fragment,{children:[a.jsx(R,{id:e.name,name:e.name,type:"file",accept:U,onChange:n=>{n.target.files&&n.target.files[0]&&g(e.name,n.target.files[0])},className:s[e.name]?"border-red-500":"",disabled:i==="view"}),i==="edit"&&h[e.name]&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Current file: ",h.featured_image_original_name||h[e.name]]}),e.fileValidation&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.fileValidation.extensions&&a.jsxs("span",{children:[y("Allowed extensions"),": ",e.fileValidation.extensions.join(", ")," "]}),e.fileValidation.maxSize&&a.jsxs("span",{children:[y("Max size"),": ",(e.fileValidation.maxSize/(1024*1024)).toFixed(1),"MB"]})]}),Z&&a.jsx("div",{className:"mt-2",children:t[e.name]&&t[e.name]instanceof File?a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[y("Preview"),":"]}),a.jsx("img",{src:URL.createObjectURL(t[e.name]),alt:"Preview",className:"h-24 w-auto rounded-md object-cover shadow-sm"})]}):i==="edit"&&h[e.name]&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[y("Current image"),":"]}),a.jsx("img",{src:typeof h[e.name]=="string"&&h[e.name].startsWith&&h[e.name].startsWith("http")?h[e.name]:`/storage/${h[e.name]}`,alt:"Current",className:"h-24 w-auto rounded-md object-cover shadow-sm",onError:n=>{n.currentTarget.src="https://placehold.co/200x150?text=Image+Not+Found"}})]})})]});case"dependent-dropdown":const D={};return(C=e.dependentConfig)==null||C.forEach(n=>{D[n.name]=t[n.name]||""}),a.jsx(Fe,{fields:e.dependentConfig||[],values:D,onChange:(n,W,f)=>{u(ee=>{var H;const _={...ee,[n]:W},G=((H=e.dependentConfig)==null?void 0:H.findIndex(M=>M.name===n))??-1;return G!==-1&&e.dependentConfig&&e.dependentConfig.slice(G+1).forEach(M=>{_[M.name]=""}),_}),e.onDependentChange&&e.onDependentChange(n,W,t,f)}});default:return null}},k=()=>{const e={sm:"sm:max-w-sm",md:"sm:max-w-md",lg:"sm:max-w-lg",xl:"sm:max-w-xl","2xl":"sm:max-w-2xl","3xl":"sm:max-w-3xl","4xl":"sm:max-w-4xl","5xl":"sm:max-w-5xl",full:"sm:max-w-full"};return x.modalSize?e[x.modalSize]:"sm:max-w-md"},Y=()=>{const e={};return x.fields.forEach(m=>{const c=m.row||0;e[c]||(e[c]=[]),e[c].push(m)}),Object.entries(e).sort(([m],[c])=>parseInt(m)-parseInt(c))},B=x.layout||"default",J=x.columns||1,K=`crud-modal-${i}-${$.replace(/\s+/g,"-").toLowerCase()}-${Date.now()}`;return a.jsx(re,{open:p,onOpenChange:j,children:a.jsxs(ce,{className:`${k()} max-h-[90vh]`,modalId:K,children:[a.jsxs(oe,{children:[a.jsx(le,{children:$}),a.jsx(me,{children:A||" "})]}),a.jsx(we,{className:"max-h-[70vh] pr-4",children:a.jsxs("form",{onSubmit:d,className:"space-y-4",children:[x.priceSummary&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[y("Unit Price"),":"]}),a.jsxs("span",{className:"font-medium",children:["$",x.priceSummary.unitPrice.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[y("Quantity"),":"]}),a.jsx("span",{className:"font-medium",children:t[x.priceSummary.quantityFieldName||"quantity"]||x.priceSummary.quantity||1})]}),a.jsx("div",{className:"border-t pt-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"font-semibold",children:[y("Total Price"),":"]}),a.jsxs("span",{className:"font-bold text-lg text-primary",children:["$",w().toFixed(2)]})]})})]}),B==="grid"?a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${J}, 1fr)`,gap:"1rem"},children:x.fields.map(e=>e.conditional&&!e.conditional(i,t)?null:a.jsxs("div",{className:"space-y-2",style:{gridColumn:e.colSpan?`span ${e.colSpan}`:"span 1",width:"100%"},children:[a.jsxs(I,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&i==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),b(e),s[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:s[e.name]})]},e.name))}):B==="flex"?a.jsx("div",{className:"flex flex-wrap gap-4",children:x.fields.map(e=>e.conditional&&!e.conditional(i,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:e.width||"100%",flexGrow:e.width?0:1},children:[a.jsxs(I,{htmlFor:e.name,className:"text-sm font-medium",children:[e.label," ",e.required&&!(e.type==="file"&&i==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),b(e),s[e.name]&&a.jsx("p",{className:"text-xs text-red-500",children:s[e.name]})]},e.name))}):Y().map(([e,m])=>a.jsx("div",{className:"flex flex-wrap gap-4 mb-4",children:m.map(c=>c.conditional&&!c.conditional(i,t)?null:a.jsxs("div",{className:"space-y-2",style:{width:c.width||"100%"},children:[a.jsxs(I,{htmlFor:c.name,className:"text-sm font-medium",children:[c.label," ",c.required&&!(c.type==="file"&&i==="edit")&&a.jsx("span",{className:"text-red-500",children:"*"})]}),b(c),s[c.name]&&a.jsx("p",{className:"text-xs text-red-500",children:s[c.name]})]},c.name))},e))]})}),a.jsxs(ie,{className:"sm:justify-end",children:[a.jsx(Q,{type:"button",variant:"outline",onClick:j,children:y("Cancel")}),i!=="view"&&a.jsx(Q,{type:"button",onClick:d,children:y("Save")})]})]})})}export{ke as C};
