import{r as l,j as e}from"./ui-5WRyBZNT.js";import{P as K}from"./page-template-CKIx2Cd4.js";import{u as U,c as Z,r as h,D as H,h as L,i as V,j as $,t as o}from"./app-Dcb6Z4yW.js";import{T as _,C as z}from"./CrudTable-bZrcaGsl.js";import{P as G}from"./pagination-BW8eSOCk.js";import{S as J}from"./search-and-filter-bar-BYwCPSIS.js";import"./textarea-LYs2mVcU.js";import"./select-DeRz6PSF.js";import"./index-BdQq_4o_.js";import"./index-CCaALC5E.js";import"./language-WoaYFWNr.js";import"./trophy-CwLH3bof.js";import"./loader-circle-BHYyy5xm.js";import"./copy-CEvMX_m9.js";import"./CookieConsentBanner-DQyHDBeh.js";import"./switch-t9Hay6Hq.js";import"./chevron-right-D-6n0McF.js";import"./credit-card-DqjaQidM.js";import"./dollar-sign-Cwr3Gu39.js";import"./users-CMrPg0xJ.js";import"./clock-bjnTPlpB.js";import"./calendar-DCWku5XV.js";import"./user-mASyYuwG.js";import"./use-favicon-DuYrl8Bg.js";import"./use-brand-theme-Bndhjp9t.js";/* empty css            *//* empty css                  */import"./utils-BkYo4WJR.js";import"./table-CVC2OwXt.js";import"./unlink-M-7GhMDo.js";import"./wrench-EpLqRNAD.js";import"./arrow-left-2RHqSM1t.js";import"./ticket-49lGndAA.js";import"./lock-open-C1AE0wa5.js";import"./award-Ds8Pn3VU.js";import"./ban-CoJEhB2G.js";import"./wallet-V5ITs3Yp.js";import"./bell-DGfoV3HU.js";import"./building-2-NAKjIPfs.js";import"./building-Yd460mDP.js";import"./trending-down-uJsbmf-r.js";import"./camera-8w012zob.js";import"./chart-column-B4Juta60.js";import"./chart-no-axes-column-increasing-CxynlTOn.js";import"./chevron-left-CAhfRZ8t.js";import"./circle-alert-DyiJ_7fc.js";import"./circle-check-big-DvjFjVFs.js";import"./circle-check-SPi-Xvck.js";import"./circle-CTH8Grzw.js";import"./clipboard-list-BeCtsJjD.js";import"./zap-C99Wcc2V.js";import"./download-D7x9V5HF.js";import"./ellipsis-CcCiYkNb.js";import"./external-link-jFGKNT7b.js";import"./eye-off-ZW0JdLst.js";import"./eye-BauIsDws.js";import"./filter-CUtbTrvr.js";import"./rotate-ccw-C8Q-gmhj.js";import"./hard-drive-B2P2rmjY.js";import"./info-DMPjqPji.js";import"./key-CGMSITmc.js";import"./lightbulb-CAdzOdqD.js";import"./link-2-DCTQflBu.js";import"./list-DOApis6K.js";import"./lock-DTdsSPVo.js";import"./mail-DLXHGnVS.js";import"./map-pin-zN3uCaOh.js";import"./phone-C8cPu9FG.js";import"./printer-ChUpiFfe.js";import"./refresh-cw-BLGufQC4.js";import"./send-COw_7dkc.js";import"./server-B9axTPGI.js";import"./square-pen-B2niO3pF.js";import"./star-C6nMG0b0.js";import"./trash-2-CeLXIVfe.js";import"./trash-BE31V_4e.js";import"./trending-up-ClbmsTa0.js";import"./triangle-alert-Bgud0J1k.js";import"./user-plus-Dd4He1MR.js";function Nt(){var S;const{t:r}=U(),{auth:x,biometricData:s,filters:c={},configurationMissing:u}=Z().props,k=(x==null?void 0:x.permissions)||[],[m,g]=l.useState(c.search||""),[d,f]=l.useState(c.start_date||""),[p,y]=l.useState(c.end_date||""),[w,j]=l.useState(!1),[P,b]=l.useState(!1),[N,T]=l.useState([]),[i,C]=l.useState(null),F=()=>m!==""||d!==""||p!=="",D=()=>(m?1:0)+(d?1:0)+(p?1:0),A=t=>{t.preventDefault(),v()},v=()=>{h.get(route("hr.biometric-attendance.index"),{page:1,search:m||void 0,start_date:d||void 0,end_date:p||void 0,per_page:c.per_page},{preserveState:!0,preserveScroll:!0})},E=(t,n)=>{switch(t){case"view":R(n);break;case"sync":B(n);break}},R=async t=>{try{const a=await(await fetch(route("hr.biometric-attendance.show",{employeeCode:t.employee_code,date:t.date}))).json();a.success?(T(a.data.entries),C({code:a.data.employee_code,date:a.data.date,name:t.name}),b(!0)):o.error(r(a.message||"Failed to fetch details"))}catch{o.error(r("Error fetching details"))}},B=t=>{o.loading(r("Syncing biometric data..."));const n={biometric_emp_id:t.employee_code,biometric_id:t.id,date:t.date,clock_in:t.clock_in,clock_out:t.clock_out};h.post(route("hr.biometric-attendance.sync",t.id),n,{onSuccess:a=>{o.dismiss(),a.props.flash.success?o.success(r(a.props.flash.success)):a.props.flash.error&&o.error(r(a.props.flash.error))},onError:a=>{o.dismiss(),typeof a=="string"?o.error(a):o.error(`Failed to sync: ${Object.values(a).join(", ")}`)}})},q=()=>{g(""),f(""),y(""),j(!1),h.get(route("hr.biometric-attendance.index"),{page:1,per_page:c.per_page},{preserveState:!0,preserveScroll:!0})},I=[{title:r("Dashboard"),href:route("dashboard")},{title:r("Biometric Attendance")}],M=[{label:r("Details"),icon:"Eye",action:"view",className:"text-blue-500",requiredPermission:"view-biometric-attendance"},{label:r("Sync"),icon:"RefreshCw",action:"sync",className:"text-green-500",requiredPermission:"sync-biometric-attendance",condition:t=>t.sync_status!=="synced"}],O=[{key:"employee_code",label:r("Employee Code"),sortable:!1,render:t=>e.jsx("span",{className:"font-mono text-sm font-medium",children:t})},{key:"name",label:r("Employee Name"),sortable:!1,render:t=>e.jsx("span",{className:"font-medium",children:t})},{key:"date",label:r("Date"),sortable:!1,render:t=>e.jsx("span",{className:"text-sm",children:window.appSettings.formatDateTimeSimple(t,!1)})},{key:"clock_in",label:r("Clock In"),sortable:!1,render:t=>e.jsx("span",{className:"font-mono text-sm font-medium text-green-600",children:t||"-"})},{key:"clock_out",label:r("Clock Out"),sortable:!1,render:t=>e.jsx("span",{className:"font-mono text-sm font-medium text-red-600",children:t||"-"})},{key:"total_entries",label:r("Total Entries"),sortable:!1,render:t=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t})}];return e.jsxs(K,{title:r("Biometric Attendance"),url:"/hr/biometric-attendance",breadcrumbs:I,noPadding:!0,children:[!u&&e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow mb-4 p-4",children:e.jsx(J,{searchTerm:m,onSearchChange:g,onSearch:A,searchPlaceholder:r("Search by employee name or code..."),filters:[{name:"start_date",label:r("Start Date"),type:"date",value:d,onChange:f},{name:"end_date",label:r("End Date"),type:"date",value:p,onChange:y}],showFilters:w,setShowFilters:j,hasActiveFilters:F,activeFilterCount:D,onResetFilters:q,onApplyFilters:v,currentPerPage:((S=c.per_page)==null?void 0:S.toString())||"10",onPerPageChange:t=>{h.get(route("hr.biometric-attendance.index"),{page:1,per_page:parseInt(t),search:m||void 0,start_date:d||void 0,end_date:p||void 0},{preserveState:!0,preserveScroll:!0})}})}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{children:r("Biometric attendance data from device")})]})}),u?e.jsx("div",{className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsx(_,{className:"h-16 w-16 mx-auto text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:r("Configuration Required")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:r("Please configure ZKTeco API settings to fetch biometric attendance data.")}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:r("Required settings:")}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:r("ZKTeco API URL")}),e.jsx("li",{children:r("Username")}),e.jsx("li",{children:r("Password")}),e.jsx("li",{children:r("Auth Token")})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(z,{columns:O,actions:M,data:(s==null?void 0:s.data)||[],from:(s==null?void 0:s.from)||1,onAction:E,permissions:k,entityPermissions:{view:"view-biometric-attendance",create:"manage-biometric-attendance",edit:"manage-biometric-attendance",delete:"manage-biometric-attendance"}}),e.jsx(G,{from:(s==null?void 0:s.from)||0,to:(s==null?void 0:s.to)||0,total:(s==null?void 0:s.total)||0,links:s==null?void 0:s.links,entityName:r("biometric records"),onPageChange:t=>h.get(t)})]})]}),e.jsx(H,{open:P,onOpenChange:b,children:e.jsxs(L,{className:"max-w-2xl",children:[e.jsx(V,{children:e.jsxs($,{children:[r("Punch Details")," - ",i==null?void 0:i.name," (",i==null?void 0:i.code,")",e.jsx("br",{}),e.jsx("span",{className:"text-sm font-normal text-gray-600",children:(i==null?void 0:i.date)&&window.appSettings.formatDateTimeSimple(i.date,!1)})]})}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:r("Time")}),e.jsx("th",{className:"text-left p-2",children:r("Status")}),e.jsx("th",{className:"text-left p-2",children:r("Verify Type")}),e.jsx("th",{className:"text-left p-2",children:r("Terminal")})]})}),e.jsx("tbody",{children:N.map((t,n)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-mono",children:t.time}),e.jsx("td",{className:"p-2",children:t.punch_state_display}),e.jsx("td",{className:"p-2",children:t.verify_type_display}),e.jsx("td",{className:"p-2",children:t.terminal_alias})]},t.id))})]}),N.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:r("No entries found")})]})]})})]})}export{Nt as default};
